var jsfile=document.querySelector('script[src*="reviews.js"]');var pageId=jsfile.getAttribute('data-pageId')||'1';var txt1=jsfile.getAttribute('data-txt1')||'0';var txt2=jsfile.getAttribute('data-txt2')||'Rating based on';var txt3=jsfile.getAttribute('data-txt3')||'users';var currentRating=0;function getCookie(name){var nameEQ=name+"=";var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)===' ')c=c.substring(1,c.length);if(c.indexOf(nameEQ)===0)return c.substring(nameEQ.length,c.length);}
return null;}
function setCookie(name,value,days){var expires="";if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));expires="; expires="+date.toUTCString();}
document.cookie=name+"="+(value||"")+expires+"; path=/";}
function updateStars(hoverIndex,isRated=false,isHover=false){const stars=document.querySelectorAll('.stars .star');const fullStars=Math.floor(currentRating);const halfStar=currentRating%1>=0.5&&isRated;stars.forEach((star,idx)=>{star.classList.remove('rated','half-rated','hover');if(isRated){if(idx<fullStars){star.classList.add('rated');}else if(idx===fullStars&&halfStar){star.classList.add('half-rated');}}
if(isHover){if(idx<hoverIndex){star.classList.add('hover');}}});}
document.querySelectorAll('.stars .star-container').forEach((container,idx)=>{container.onmouseover=()=>{updateStars(idx+1,false,true);};container.onmouseout=()=>{updateStars(currentRating,true,false);};container.onclick=()=>{let rating=idx+1;if(getCookie('voted_page_'+pageId)){alert(txt1);return;}
fetch('/include/ajax/submit_vote.php',{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'},body:'rating='+rating+'&page_id='+pageId}).then(response=>response.text()).then(data=>{document.getElementById('ratingResult').innerHTML=data;currentRating=rating;updateStars(rating,true);}).catch(error=>console.error('Erreur:',error));};});window.onload=function(){fetch('/include/ajax/reviews_stats.php?page_id='+pageId).then(response=>response.json()).then(data=>{var ratingElement=document.getElementById('ratingResult');ratingElement.innerHTML=txt2+' '+data.totalVotes+' '+txt3;currentRating=data.averageRating;updateStars(data.averageRating,true);var starsContainer=document.querySelector('.stars');starsContainer.insertAdjacentHTML('afterend',' ('+data.averageRating+')');}).catch(error=>console.error('Erreur:',error));};